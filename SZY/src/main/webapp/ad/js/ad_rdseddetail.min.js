var AJAXFALSE='<tr><td colspan="13">数据异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a></td></tr>',AJAXFERROR='<tr><td colspan="13">数据链接异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a></td></tr>';
var ORDER_AJAX_DATA={size:5,number:1,id:-1};$(function(){var b=location.search;if(b&&b!=""&&b!=null){var a=getSearchAsArray(b);if(a.spid){ORDER_AJAX_DATA.id=a.spid;
getAllOrderInfo();}else{alert("请求参数错误");location.href="rdsed";}}else{alert("请求参数错误");location.href="rdsed";}});function getAllOrderInfo(a){var c=$("#J_rdsedOrderTb"),b=$("#J_rdsedDbTb");
if(a){ORDER_AJAX_DATA.number=a;}$.ajax({url:AJAXURL.getDetail,data:ORDER_AJAX_DATA,type:"POST",dataType:"JSON",beforeSend:function(){c.html('<tr><td colspan="13"><i class="load-one">拼命加载中...</i></td></tr>');
},success:function(e){if(e.state){var f=e.data,d=f.order;c.html(createOrderInfoHTML(d.list));if(d.list.length>0){new PAGE("J_comPage",ORDER_AJAX_DATA.number,d.totalPage,getAllOrderInfo);
}$("#J_rdsedSpName").html(f.name);$("#J_rdsedSpSize").html(f.storage);$("#J_rdsedSpCons").html(f.max_conn);$("#J_rdsedSpState").html(getSpaceState(f.state));
$("#J_rdsedSpEndTime").html(getLocalTime(f.end_time));$("#J_rdsedSpRemark").html(f.remarks);b.html(createDBInfoHTML(f.dbs));}else{c.html(AJAXFALSE);b.html(AJAXFALSE);
}},error:function(){c.html(AJAXFERROR);b.html(AJAXFERROR);}});}function createOrderInfoHTML(e){if(e){var d=[],b=e.length;if(b>0){for(var c=0;c<b;c++){var a=e[c],f=a.check_time==0?"--":getLocalTime(a.check_time);
typename=getOrderType(a.type),pay_state_name=getPayStateName(a.pay_state),check_state_name=getOrderCheckState(a.check_state),ctime=getLocalTime(a.ctime);
d.push("<tr>");d.push("<td>"+a.order_num+"</td>");d.push("<td>"+typename+"</td>");d.push("<td>"+ctime+"</td>");d.push("<td>"+f+"</td>");d.push("<td>"+a.account_email+"</td>");
d.push("<td>"+a.account_name+"</td>");d.push("<td>"+a.account_phone+"</td>");d.push("<td>"+typename+"</td>");d.push("<td>"+check_state_name+"</td>");d.push("<td>"+a.add_store+"GB</td>");
d.push("<td>"+a.add_conn+"个</td>");d.push("<td>"+a.add_month+"月</td>");d.push("<td>￥"+a.price+"</td>");d.push("</tr>");}}else{d.push('<tr><td colspan="13">没有查找到相关条件的结果</td></tr>');
}return d.join("");}}function createDBInfoHTML(e){if(e){var d=[],a=e.length;if(a>0){for(var c=0;c<a;c++){var b=e[c],g=b.state==0?{name:"正常",_switch:"off"}:{name:"禁用",_switch:"on"},f=getLocalTime(b.ctime);
d.push("<tr>");d.push("<td>"+b.db_name+"</td>");d.push("<td>"+g.name+"</td>");d.push("<td>"+b.charset+"</td>");d.push("<td>NDB Cluster</td>");d.push("<td>"+b.used_storage+"GB/<strong>"+b.storage+"GB</strong></td>");
d.push("<td>"+f+"</td>");if(b.remarks==""){d.push('<td><a href="javascript:void(0);" data-toggle="modal" data-target="#editRemark" onclick="editRemark('+b.id+');return false;">编辑</a></td>');
}else{d.push('<td><span id="J_rdsedDbRemarks_'+b.id+'">'+b.remarks+'</span>   <a href="javascript:void(0);" data-toggle="modal" data-target="#editRemark" onclick="editRemark('+b.id+');return false;">编辑</a></td>');
}d.push('<td><a class="switch-btn '+g._switch+'" href="javascript:void(0);" data-toggle="modal" data-target="#onAndOffDb" onclick="onAndOffDb('+b.id+","+b.state+');return false;"></a></td>');
d.push("</tr>");}}else{d.push('<tr><td colspan="8">没有查找到相关条件的结果</td></tr>');}return d.join("");}}function editRemark(b){var a=$("#J_rdsedDbRemarks_"+b).text();
$("#J_rdsedDbRemark").val(a);$("#J_submitDbRemark").on("click",function(){var d=$.trim($("#J_rdsedDbRemark").val()),c=$("#J_rdsedDbRemarkError");if(d.length>20){c.removeClass("none").html("备注信息不能多余20字");
return false;}$.ajax({url:AJAXURL.editDbRemark,data:{id:b,remarks:d},type:"POST",dataType:"JSON",success:function(e){if(e.state){alert("备注添加成功，确定后将刷新页面！");
location.reload();}else{alert("数据异常，请稍后再试");}},error:function(){alert("链接异常，请稍后再试");}});});}function onAndOffDb(a,c){new vfCode("J_vfCodeImg","J_vfCodeChange","onAndOffDb");
var b="";if(c==0){$("#J_rdsedDbOfTitle").html("关闭数据库");$("#J_rdsedDbOfCont").html("确定关闭数据库吗？");b=AJAXURL.dbForbid;}else{if(c==1){$("#J_rdsedDbOfTitle").html("启用数据库");
$("#J_rdsedDbOfCont").html("确定启用数据库吗？");b=AJAXURL.dbRecovery;}}$("#J_submitDbOnAndOff").on("click",function(){var d=$.trim($("#J_rdsedDbOfYzm").val());
if(!RE.NULL.test(d)){alert("请输入验证码");return false;}if(!/^[a-zA-Z0-9]{6}$/.test(d)){alert("验证码不正确");return false;}$.ajax({url:b,data:{id:a,input:d,captcha:"delAdmin"},type:"POST",dataType:"JSON",success:function(e){if(e.state){location.reload();
}else{alert("数据异常，请稍后再试！");new vfCode("J_vfCodeImg","J_vfCodeChange","onAndOffSpace");}},error:function(){alert("链接异常，请稍后再试！");}});});}