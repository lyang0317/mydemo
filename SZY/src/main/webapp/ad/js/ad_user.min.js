var pageSize=5,currPage=1;$(function(){loadUserInfo();userStateChange();searchKeyChange();});function loadUserInfo(b){if(b){currPage=b;}var a=$("#J_userTbody");
$.ajax({url:AJAXURL.byPage,data:{currentPage:currPage,pageSize:pageSize},type:"POST",dataType:"JSON",beforeSend:function(){a.html('<tr><td colspan="8"><i class="load-one">拼命加载中...</i></td></tr>');
},success:function(c){if(c.state){a.html(createUserListHtml(c.data));new PAGE("J_comPage",currPage,c.totalPage,loadUserInfo);}else{a.html('<tr><td colspan="8">数据链接异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a></td></tr>');
}},error:function(){a.html('<tr><td colspan="8">数据链接异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a></td></tr>');}});}function createUserListHtml(f){if(f){var j=[],k=f.length;
if(k>0){for(var g=0;g<k;g++){var h=f[g].userid,l=f[g].email==null?"":f[g].email,e=f[g].tel==null?"":f[g].tel,a=f[g].name==null?"":f[g].name,m=f[g].realname==null?"":f[g].realname,d=f[g].comname==null?"":f[g].comname,b=f[g].time==null?"":f[g].time,c=f[g].status==null?"":f[g].status,n=c==0?"off":"on";
j.push("<tr>");j.push("<td>"+l+"</td>");j.push("<td>"+e+"</td>");j.push("<td>"+a+"</td>");j.push("<td>"+m+"</td>");j.push("<td>"+d+"</td>");j.push("<td>"+b+"</td>");
j.push('<td><a class="switch-btn '+n+'" href="javascript:;" onclick="userStateChangeClick('+h+","+c+');"></a></td>');j.push('<td><a href="message?userid='+h+"&email="+l+'" target="_blank" title="发送消息">发送消息</a></td>');
j.push("</tr>");}}else{j.push('<tr><td colspan="8">暂无数据</tr>');$("#J_comPage").html("");}return j.join("");}}var USERSTATE=null;function userStateChange(){$("#J_userState input").on("change",function(){var a=$(this).val();
USERSTATE=a;userStateChangeAjax();});}function userStateChangeAjax(b){if(b){currPage=b;}var a=$("#J_userTbody");$.ajax({url:AJAXURL.byStatus,data:{status:USERSTATE,currentPage:currPage,pageSize:pageSize},type:"POST",dataType:"JSON",beforeSend:function(){a.html('<tr><td colspan="8"><i class="load-one">拼命加载中...</i></td></tr>');
},success:function(c){if(c.state){$("#J_userTbody").html(createUserListHtml(c.data));new PAGE("J_comPage",currPage,c.totalPage,userStateChangeAjax);}else{a.html('<tr><td colspan="8">数据链接异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a></td></tr>');
}},error:function(){a.html('<tr><td colspan="8">数据链接异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a></td></tr>');}});}function userStateChangeClick(b,a){var c=a==0?1:0,d=a==0?"确定启用吗？":"确定禁用吗？";
ALERT.init({info:d,callback:function(){$.ajax({url:AJAXURL.updateStatus,data:{userid:b,status:c},type:"POST",dataType:"JSON",success:function(e){if(e.state){location.reload();
}else{}}});}});}function searchKeyChange(){var c=$("#J_userSchKeyList a"),b=c.length;for(var a=0;a<b;a++){c[a]._i=a;c[a].onclick=function(){var e=this,d=$("#J_userSchKey").attr("data-key");
dataKey=$(e).attr("data-key"),key=$(e).html();$("#J_userSchKey").attr("data-key",dataKey);$("#J_userSchKey").html(key);};}}function userSearch(){var a=$("#J_userSchKey").attr("data-key"),c=$("#J_userSchValue").val();
var b=$("#J_userTbody");$("#J_comPage").html("");$.ajax({url:AJAXURL.byAttr,data:{attr:c},type:"POST",dataType:"JSON",beforeSend:function(){b.html('<tr><td colspan="8"><i class="load-one">拼命加载中...</i></td></tr>');
},success:function(d){if(d.state){b.html(createUserListHtml(d.data));}else{b.html('<tr><td colspan="8">数据异常，请稍后再试</td></tr>');}},error:function(){b.html('<tr><td colspan="8">链接异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a></td></tr>');
}});}