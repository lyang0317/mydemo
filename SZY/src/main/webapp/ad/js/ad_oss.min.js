var ERROR_TEXT={AJAXFALSE:'数据异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a>',AJAXERROR:'链接异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a>',AJAX_FALSE:'数据异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a>',AJAX_ERROR:'链接异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a>'};
var OSS_AJAX_DATA={size:7,number:1,pay_state:2,check_state:0};$(function(){getAllOrder();searchKeyChange();$("#J_adSchValue").keydown(function(a){if(a.keyCode==13){orderSearch();
}});});function getAllOrder(b){$("#J_comPage").html("");if(b){OSS_AJAX_DATA.number=b;}var a=$("#J_ossTbBody");$.ajax({url:AJAXURL.queryByCstateAndPstate,data:OSS_AJAX_DATA,type:"POST",dataType:"JSON",beforeSend:function(){a.html('<i class="load-one">拼命加载中...</i>');
},success:function(c){if(c.state){a.html(createOrderListHtml(c.data.list));if(c.data.list.length>0){new PAGE("J_comPage",OSS_AJAX_DATA.number,c.data.totalPage,getAllOrder);
ossOrderCopy();}}else{a.html(ERROR_TEXT.AJAX_FALSE);}},error:function(){a.html(ERROR_TEXT.AJAX_ERROR);}});}function createOrderListHtml(f){if(f){var d=[],b=f.length;
if(b>0){for(var c=0;c<b;c++){var a=f[c],e=getOrderType(a.type),h=getPayStateName(a.pay_state);d.push('<div class="panel-list panel panel-default">');d.push('<div class="panel-heading">');
d.push('<h3 class="pull-left panel-title">订单号：<span>'+a.order_num+'</span>  <a class="more" href="ossdetail?orderid='+a.order_num+'" target="_blank" title="详情>>">详情>></a></h3>');
d.push('<div id="J_ossCopyBox_0" class="rds-copy pull-right"><a class="copy-tag" href="javascript::" title="复制订单号:'+a.order_num+'" data-clipboard-text="'+a.order_num+'">复制订单号</a></div>');
d.push("</div>");d.push('<div class="panel-body">');d.push('<table class="tb-bd table" width="100%">');d.push("<tr>");d.push('<td width="25%">'+a.user_email+"</td>");
d.push('<td width="15%"><div class="line">'+a.user_realname+"</div></td>");d.push('<td width="20%"><div class="line">'+a.order_time+"</div></td>");d.push('<td width="10%"><div class="line">'+h+"</div></td>");
d.push('<td width="10%"><div class="line price">￥'+a.price+"</div></td>");d.push('<td><div class="line">');if(a.user_operate==0){if(a.check_state==0){d.push('<a href="javascript:;" onclick="payAndAgree(\''+a.order_num+'\');">已付款并通过</a> | <a href="javascript:;" onclick="denyOrder(\''+a.order_num+"');return false;\">拒绝</a>");
}else{var g=getOrderCheckState(a.check_state);d.push(g);}}else{d.push("已取消");}d.push("</div></td>");d.push("</tr>");d.push("</table>");d.push("</div>");
d.push("</div>");}}else{d.push('<div class="tc mt20">没有查找到相关条件的结果</div>');$("#J_comPage").html("");}return d.join("");}}function orderStateChange(a){OSS_AJAX_DATA.number=1;
OSS_AJAX_DATA.pay_state=a;getAllOrder();}function orderCheckChange(a){OSS_AJAX_DATA.check_state=a;OSS_AJAX_DATA.number=1;getAllOrder();}function orderSearch(a){var c=$.trim($("#J_adSchValue").val()),d=$("#J_adSchKey").attr("data-key"),b=$("#J_ossTbBody");
if(!RE.NULL.test(c)){return false;}else{var e={currPage:1,pageSize:7,condition_state:d,check_state:0,condition:c,};if(a){e.currPage=a;}$.ajax({url:AJAXURL.getOrderByConditions,data:e,type:"POST",dataType:"JSON",beforeSend:function(){b.html('<i class="load-one">拼命加载中...</i>');
},success:function(f){if(f.state){b.html(createOrderListHtml(f.data.list));if(f.data.list.length>0){new PAGE("J_comPage",e.currPage,f.data.totalPage,orderSearch);
ossOrderCopy();}}else{b.html(ERROR_TEXT.AJAX_FALSE);}},error:function(){b.html(ERROR_TEXT.AJAX_ERROR);}});}}function payAndAgree(a){if(a){ALERT.init({info:"确定已付款并通过吗？",callback:function(){$.ajax({url:AJAXURL.passByid,data:{id:a},type:"POST",dataType:"JSON",success:function(b){if(b.state){location.reload();
}else{alert(ERROR_TEXT.AJAXFALSE);}},error:function(){alert(ERROR_TEXT.AJAXERROR);}});}});}}function denyOrder(a){if(a){ALERT.init({info:"确定拒绝吗？",callback:function(){$.ajax({url:AJAXURL.refusedById,data:{id:a},type:"POST",dataType:"JSON",success:function(b){if(b.state){location.reload();
}else{alert(ERROR_TEXT.AJAXERROR);}},error:function(){alert(ERROR_TEXT.AJAXERROR);}});}});}}function searchKeyChange(){var d=$("#J_adSchKeyList a"),c=d.length,b=$("#J_adSchKey");
for(var a=0;a<c;a++){d[a]._i=a;d[a].onclick=function(){var f=this,e=b.attr("data-key");dataKey=$(f).attr("data-key"),key=$(f).html();b.attr("data-key",dataKey);
b.html(key);};}}function ossOrderCopy(){var a=new ZeroClipboard($("#J_ossTbBody .copy-tag"));a.on("aftercopy",function(b){ALERT.init({info:"订单号已成功复制到剪贴板"});
});}