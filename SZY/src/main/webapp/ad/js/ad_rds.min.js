var ERROR_TEXT={AJAXFALSE:'数据异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a>',AJAXERROR:'链接异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a>',AJAX_FALSE:'数据异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a>',AJAX_ERROR:'链接异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a>'};
var RDS_AJAX_DATA={size:7,number:1,pay_state:-1,check_state:-1,type:-1,order_num:"",account_email:"",account_name:""};$(function(){getAllOrder();orderKindChange();
searchKeyChange();$("#J_adSchValue").keydown(function(a){if(a.keyCode==13){orderSearch();}});});function getAllOrder(a){$("#J_comPage").html("");if(a){RDS_AJAX_DATA.number=a;
}var b=$("#J_rdsTbBody");$.ajax({url:AJAXURL.getAllOrder,data:RDS_AJAX_DATA,type:"POST",dataType:"JSON",beforeSend:function(){b.html('<i class="load-one">拼命加载中...</i>');
},success:function(c){if(c.state){b.html(createOrderListHtml(c.data.list));if(c.data.list.length>0){new PAGE("J_comPage",RDS_AJAX_DATA.number,c.data.totalPage,getAllOrder);
rdsOrderCopy();}}else{b.html(ERROR_TEXT.AJAX_FALSE);}},error:function(){b.html(ERROR_TEXT.AJAX_ERROR);}});}function createOrderListHtml(f){if(f){var d=[],b=f.length;
if(b>0){for(var c=0;c<b;c++){var a=f[c],e=getOrderType(a.type),h=getPayStateName(a.pay_state);d.push('<div class="panel-list panel panel-default">');d.push('<div class="panel-heading">');
d.push('<h3 class="pull-left panel-title">订单号：<span>'+a.order_num+'</span>  <a class="more" href="rdsdetail?orderid='+a.order_num+'" target="_blank" title="详情>>">详情>></a></h3>');
d.push('<div id="J_rdsCopyBox_0" class="rds-copy pull-right"><a class="copy-tag" href="javascript::" title="复制订单号:'+a.order_num+'" data-clipboard-text="'+a.order_num+'">复制订单号</a></div>');
d.push("</div>");d.push('<div class="panel-body">');d.push('<table class="tb-bd table" width="100%">');d.push("<tr>");d.push('<td width="18%">'+a.space_name+"</td>");
d.push('<td width="18%"><div class="line">'+a.account_email+"</div></td>");d.push('<td width="8%"><div class="line">'+a.account_name+"</div></td>");d.push('<td width="18%"><div class="line">'+a.date+"</div></td>");
d.push('<td width="7%"><div class="line">'+e+"</div></td>");d.push('<td width="7%"><div class="line">'+h+"</div></td>");d.push('<td width="7%"><div class="line price">￥'+a.price+"</div></td>");
d.push('<td width="17%"><div class="line">');if(a.check_state==0){d.push('<a href="javascript:;" onclick="payAndAgree(\''+a.order_num+'\');">已付款并通过</a> | <a href="javascript:;" onclick="denyOrder(\''+a.order_num+"');return false;\">拒绝</a>");
}else{var g=getOrderCheckState(a.check_state);d.push(g);}d.push("</div></td>");d.push("</tr>");d.push("</table>");d.push("</div>");d.push("</div>");}}else{d.push('<div class="tc mt20">没有查找到相关条件的结果</div>');
$("#J_comPage").html("");}return d.join("");}}function orderStateChange(a){RDS_AJAX_DATA.pay_state=a;RDS_AJAX_DATA.number=1;getAllOrder();}function orderCheckChange(a){RDS_AJAX_DATA.check_state=a;
RDS_AJAX_DATA.number=1;getAllOrder();}function orderKindChange(){var b=$("#J_rdsOrderKind input[name='orderKind']");for(var a=0;a<b.length;a++){b[a].onclick=function(){var c=this.value;
RDS_AJAX_DATA.type=c;getAllOrder();};}}function orderSearch(){var a=$.trim($("#J_adSchValue").val()),b=$("#J_adSchKey").attr("data-key");if(!RE.NULL.test(a)){return false;
}else{if(b=="orderid"){RDS_AJAX_DATA.order_num=a;RDS_AJAX_DATA.account_email="";RDS_AJAX_DATA.account_name="";}else{if(b=="email"){RDS_AJAX_DATA.order_num="";
RDS_AJAX_DATA.account_email=a;RDS_AJAX_DATA.account_name="";}else{if(b=="realname"){RDS_AJAX_DATA.order_num="";RDS_AJAX_DATA.account_email="";RDS_AJAX_DATA.account_name=a;
}}}}getAllOrder();}function payAndAgree(a){if(a){ALERT.init({info:"确定已付款并通过吗？",callback:function(){$.ajax({url:AJAXURL.payAndAllow,data:{order_num:a},type:"POST",dataType:"JSON",success:function(b){if(b.state){location.reload();
}else{alert(ERROR_TEXT.AJAXFALSE);}},error:function(){alert(ERROR_TEXT.AJAXERROR);}});}});}}function denyOrder(a){if(a){ALERT.init({info:"确定拒绝吗？",callback:function(){$.ajax({url:AJAXURL.refuseOrder,data:{order_num:a},type:"POST",dataType:"JSON",success:function(b){if(b.state){location.reload();
}else{alert(ERROR_TEXT.AJAXERROR);}},error:function(){alert(ERROR_TEXT.AJAXERROR);}});}});}}function searchKeyChange(){var d=$("#J_adSchKeyList a"),c=d.length,b=$("#J_adSchKey");
for(var a=0;a<c;a++){d[a]._i=a;d[a].onclick=function(){var f=this,e=b.attr("data-key");dataKey=$(f).attr("data-key"),key=$(f).html();b.attr("data-key",dataKey);
b.html(key);};}}function rdsOrderCopy(){var a=new ZeroClipboard($("#J_rdsTbBody .copy-tag"));a.on("aftercopy",function(b){ALERT.init({info:"订单号已成功复制到剪贴板"});
});}