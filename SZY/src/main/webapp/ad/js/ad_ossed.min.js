var AJAXFALSE='<tr><td colspan="5">数据异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a></td></tr>',AJAXFERROR='<tr><td colspan="5">数据链接异常，请稍后<a href="javascript:;" onclick="location.reload();return false;">重试</a></td></tr>';
var OSSED_AJAX_DATA={pageSize:7,currPage:1,check_state:2,};$(function(){getAllSpace();searchKeyChange();$("#J_adSchValue").keydown(function(a){if(a.keyCode==13){spaceSearch();
}});});function getAllSpace(a){var b=$("#J_ossSpaceTbody");if(a){OSSED_AJAX_DATA.currPage=a;}$.ajax({url:AJAXURL.getChecked,data:OSSED_AJAX_DATA,type:"POST",dataType:"JSON",beforeSend:function(){b.html('<tr><td colspan="5"><i class="load-one">拼命加载中...</i></td></tr>');
},success:function(c){if(c.state){b.html(createSpaceListHtml(c.data.list));if(c.data.list.length>0){new PAGE("J_comPage",OSSED_AJAX_DATA.currPage,c.data.totalPage,getAllSpace);
}else{$("#J_comPage").html("");}}else{b.html(AJAXFALSE);}},error:function(){b.html(AJAXFERROR);}});}function createSpaceListHtml(e){if(e){var c=[],a=e.length;
if(a>0){for(var b=0;b<a;b++){var d=e[b];c.push("<tr>");c.push("<td>"+d.user_email+"</td>");c.push("<td>"+d.user_realname+"</td>");c.push("<td>"+d.used_space+"GB/<strong>"+d.all_space+"GB</strong></td>");
if(d.remarks==null){c.push('<td><a href="javascript:void(0);" data-toggle="modal" data-target="#editRemark" onclick="editRemark(\''+d.order_num+"');return false;\">编辑</a></td>");
}else{c.push('<td><span id="J_ossedRemarks_'+d.order_num+'">'+d.remarks+'</span>   <a href="javascript:void(0);" data-toggle="modal" data-target="#editRemark" onclick="editRemark(\''+d.order_num+"');return false;\">编辑</a></td>");
}c.push('<td><a href="ossdirectory?user_email='+d.user_email+'" target="_blank">查看目录</a>&ensp;&ensp;|&ensp;&ensp;<a href="osseddetail?orderid='+d.order_num+'" target="_blank">详情</a></td>');
c.push("</tr>");}}else{c.push('<tr><td colspan="5">没有查找到相关条件的结果</td></tr>');$("#J_comPage").html("");}return c.join("");}}function spaceSearch(a){var b=$("#J_adSchValue").val(),c=$("#J_adSchKey").attr("data-key"),e=$("#J_ossSpaceTbody");
if(!RE.NULL.test(b)){return false;}else{var d={currPage:1,pageSize:7,condition_state:c,check_state:2,condition:b,};if(a){d.currPage=a;}$.ajax({url:AJAXURL.getOrderByConditions,data:d,type:"POST",dataType:"JSON",beforeSend:function(){e.html('<tr><td colspan="5"><i class="load-one">拼命加载中...</i></td></tr>');
},success:function(f){if(f.state){e.html(createSpaceListHtml(f.data.list));if(f.data.list.length>0){new PAGE("J_comPage",OSSED_AJAX_DATA.currPage,f.data.totalPage,spaceSearch);
}else{$("#J_comPage").html("");}}else{e.html(AJAXFALSE);}},error:function(){e.html(AJAXFERROR);}});}}function editRemark(b){var a=$("#J_ossedRemarks_"+b).text();
$("#J_editRemarkText").val(a);$("#J_sureEditRemark").on("click",function(){var c=$.trim($("#J_editRemarkText").val()),d=$("#J_editRemarkError");if(c.length>20){d.removeClass("none").html("备注信息不能多余20字");
return false;}$.ajax({url:AJAXURL.addOrderRemarksByNum,data:{order_num:b,remarks:c},type:"POST",dataType:"JSON",success:function(e){if(e.state){alert("备注添加成功，确定后将刷新页面！");
location.reload();}else{alert("数据异常，请稍后再试");}},error:function(){alert("链接异常，请稍后再试");}});});}function searchKeyChange(){var d=$("#J_adSchKeyList a"),c=d.length,b=$("#J_adSchKey");
for(var a=0;a<c;a++){d[a]._i=a;d[a].onclick=function(){var f=this,e=b.attr("data-key");dataKey=$(f).attr("data-key"),key=$(f).html();b.attr("data-key",dataKey);
b.html(key);};}}