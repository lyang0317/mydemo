$(function(){loadUserInfo();});var infoUserId=$("#J_infoUserId"),infoEmail=$("#J_infoEmail"),infoUserName=$("#J_infoUserName"),infoTime=$("#J_infoTime"),infoPhone=$("#J_infoPhone"),infoName=$("#J_infoName"),infoCompany=$("#J_infoCompany"),infoCategory=$("#J_infoCategory"),infoBusiness=$("#J_infoBusiness"),infoWww=$("#J_infoWww"),infoFixedPh=$("#J_infoFixedPh"),infoPro=$("#J_infoPro"),infoCity=$("#J_infoCity"),infoArea=$("#J_infoArea"),infoStreet=$("#J_infoStreet"),infoNoticePhone=$("#J_infoNoticePhone"),infoNoticeName=$("#J_infoNoticeName"),infoNoticeCompany=$("#J_infoNoticeCompany"),infoNoticeCategory=$("#J_infoNoticeCategory"),infoNoticeBusiness=$("#J_infoNoticeBusiness"),infoNoticeWww=$("#J_infoNoticeWww"),infoNoticeFixedPh=$("#J_infoNoticeFixedPh"),infoNoticeAddess=$("#J_infoNoticeAddess");
var INFO={PHONE:{FOCUS:function(){infoNoticePhone.addClass("none");},BLUR:function(b){var a=$.trim(b);if(!RE.NULL.test(a)){infoNoticePhone.removeClass("none").html("*请填写手机号码");
return false;}if(!RE.PHONE.test(a)){infoNoticePhone.removeClass("none").html("*手机号码格式不正确");}}},NAME:{FOCUS:function(){infoNoticeName.addClass("none");},BLUR:function(b){var a=$.trim(b);
if(!RE.NULL.test(a)){infoNoticeName.removeClass("none").html("*请填写真实姓名");return false;}if(!/^(\w+|[\u4E00-\u9FA5]){2,10}$/.test(a)){infoNoticeName.removeClass("none").html("*真实姓名由2到10个字组成");
}}},COMPANY:{FOCUS:function(){infoNoticeCompany.addClass("none");},BLUR:function(b){var a=$.trim(b);if(!RE.NULL.test(a)){infoNoticeCompany.removeClass("none").html("*请填写公司名称");
return false;}if(!/^([\-]*|\w+|[\u4E00-\u9FA5]){2,20}$/.test(a)){infoNoticeCompany.removeClass("none").html("*公司名称由2到20个字组成");}}},BUSINESS:{FOCUS:function(){infoNoticeBusiness.addClass("none");
},BLUR:function(b){var a=$.trim(b);if(!RE.NULL.test(a)){return false;}if(!/^([\-]*|\w+|[\u4E00-\u9FA5]){2,20}$/.test(a)){infoNoticeBusiness.removeClass("none").html("*主营业务由2到20个字组成");
}}},WWW:{FOCUS:function(){infoNoticeWww.addClass("none");},BLUR:function(b){var a=$.trim(b);if(!RE.NULL.test(a)){return false;}if(!/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(a)){infoNoticeWww.removeClass("none").html("*网站地址格式不正确");
}}},FIXEDPH:{FOCUS:function(){infoNoticeFixedPh.addClass("none");},BLUR:function(b){var a=$.trim(b);if(!RE.NULL.test(a)){return false;}if(!/^(\d{4}-|\d{3}-)?(\d{8}|\d{7})$/.test(a)){infoNoticeFixedPh.removeClass("none").html("*固定电话格式不正确");
}}},STREET:{FOCUS:function(){infoNoticeAddess.addClass("none");},BLUR:function(b){var a=$.trim(b);if(!RE.NULL.test(a)){return false;}if(!/^([\-]*|\w+|[\u4E00-\u9FA5]){2,40}$/.test(a)){infoNoticeAddess.removeClass("none").html("*街道地址格式不正确");
}}}};function saveInfo(){var j=$.trim(infoPhone.val()),a=$.trim(infoName.val()),g=$.trim(infoCompany.val()),m=$.trim(infoCategory.val()),e=$.trim(infoBusiness.val()),f=$.trim(infoWww.val()),l=$.trim(infoFixedPh.val()),n=$.trim(infoPro.val()),i=$.trim(infoCity.val()),c=$.trim(infoArea.val()),d=$.trim(infoStreet.val());
if(!RE.NULL.test(j)){infoNoticePhone.removeClass("none").html("*请输入手机号码");return false;}else{if(!RE.PHONE.test(j)){infoNoticePhone.removeClass("none").html("*手机号码格式不正确");
return false;}}if(!RE.NULL.test(a)){infoNoticeName.removeClass("none").html("*请输入真实姓名");return false;}else{if(!/^(\w+|[\u4E00-\u9FA5]){2,10}$/.test(a)){infoNoticeName.removeClass("none").html("*真实姓名由2到10个字组成");
return false;}}if(!RE.NULL.test(g)){infoNoticeCompany.removeClass("none").html("*请输入公司名称");return false;}else{if(!/^([\-]*|\w+|[\u4E00-\u9FA5]){2,20}$/.test(g)){infoNoticeCompany.removeClass("none").html("*公司名称由2到20个字组成");
return false;}}if(!/^([\-]*|\w+|[\u4E00-\u9FA5]){2,20}$/.test(e)&&RE.NULL.test(e)){infoNoticeBusiness.removeClass("none").html("*主营业务由2到20个字组成");return false;
}if(!/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(f)&&RE.NULL.test(f)){infoNoticeWww.removeClass("none").html("*网站地址格式不正确");return false;
}if(!/^(\d{4}-|\d{3}-)?(\d{8}|\d{7})$/.test(l)&&RE.NULL.test(l)){infoNoticeFixedPh.removeClass("none").html("*固定电话格式不正确");return false;}if(!/^([\-]*|\w+|[\u4E00-\u9FA5]){2,40}$/.test(d)&&RE.NULL.test(d)){infoNoticeAddess.removeClass("none").html("*街道地址格式不正确");
return false;}var k=infoPro.find("option[value="+n+"]").html(),h=infoCity.find("option[value="+i+"]").html(),b=infoArea.find("option[value="+c+"]").html();
$.ajax({url:AJAXURL.modifyInfo,data:{tel:j,realname:a,comname:g,classofindustry:m,primarybusiness:e,websiteurl:f,fixedline:l,prov:k,city:h,area:b,street:d},type:"POST",dataType:"JSON",success:function(o){if(o.state){alert("信息已保存");
location.reload();}}});}function loadUserInfo(){$.ajax({url:AJAXURL.getUser,type:"POST",dataType:"JSON",success:function(c){if(c.state){var b=c.data;$("#J_infoEmail").html(b.email);
$("#J_infoUserName").html(b.name);$("#J_infoTime").html(b.time);$("#J_infoPhone").val(b.tel);$("#J_infoName").val(b.realname);$("#J_infoCompany").val(b.comname);
$("#J_infoCategory").val(b.classofindustry);$("#J_infoBusiness").val(b.primarybusiness);$("#J_infoWww").val(b.websiteurl);$("#J_infoFixedPh").val(b.fixedline);
var a=b.address;if(a!=null){var d=a.split("-");loadProv(d);$("#J_infoStreet").val(d[3]);}else{loadProv();}}}});}function loadProv(a){$.ajax({url:AJAXURL.getProv,type:"POST",dataType:"JSON",success:function(f){if(f.state){var d=f.data,e=d.length;
var c=[];c.push('<option value="">--省份--</option>');for(var b=0;b<e;b++){if(a&&a[0]==d[b].name){c.push('<option selected="selected" value="'+d[b].code+'">'+d[b].name+"</option>");
changeProv(a,d[b].code);}else{c.push('<option value="'+d[b].code+'">'+d[b].name+"</option>");}}$("#J_infoPro").html(c.join(""));}}});}function changeProv(c,b){var a=null;
if(b){a=b;}else{a=$("#J_infoPro").val();}$.ajax({url:AJAXURL.getCity,type:"POST",data:{code:a},dataType:"JSON",success:function(g){if(g.state){var h=g.data,d=h.length;
var f=[];f.push('<option value="">--市/州--</option>');for(var e=0;e<d;e++){if(c&&c[1]==h[e].name){f.push('<option selected="selected" value="'+h[e].code+'">'+h[e].name+"</option>");
changeCity(c,h[e].code);}else{f.push('<option value="'+h[e].code+'">'+h[e].name+"</option>");}}$("#J_infoCity").html(f.join(""));}}});}function changeCity(b,a){var c=null;
if(a){c=a;}else{c=$("#J_infoCity").val();}$.ajax({url:AJAXURL.getArea,type:"POST",data:{code:c},dataType:"JSON",success:function(h){if(h.state){var g=h.data,d=g.length;
var f=[];f.push('<option value="">--区/县--</option>');for(var e=0;e<d;e++){if(b&&b[2]==g[e].name){f.push('<option selected="selected" value="'+g[e].code+'">'+g[e].name+"</option>");
}else{f.push('<option value="'+g[e].code+'">'+g[e].name+"</option>");}}$("#J_infoArea").html(f.join(""));}}});}